<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF_8">
        <link rel="stylesheet" href="CSS/all.css">
        <link rel="stylesheet" href="CSS/style.css">
        <title>LibraHub - Add Book</title>
    </head>
    <body>
     <header>
        <div class="header-container">
            <div class="icon">
              <i class="fa-solid fa-book-open"></i>
                <h2>LibraHub</h2>
            </div>
      <div class="heah_link">
        <p class="search-p">Admin Panal</p>
        <a href="dashbord.html" class="serch-links a-login"><button class="dash-btn search-buuton">Dashboard</button></a>
        <a href="search.html" class="serch-links a-login"><button class="dash-btn search-buuton">Search</button></a>
        <a href="#" class="serch-links a-register"><button class="search-buuton" style="background-color: #5a189a;">Add Book</button></a>
        <a href="addUser.html" class="serch-links a-register"><button class="search-buuton">Add User</button></a>

        <a href="index.html" class="serch-links a-register"><button class="log-out-btn search-buuton">Log out <i class="fa-solid fa-right-from-bracket"></i></button></a>
      </div>
        </div>
     </header>

     <section class="add-form">
       <div class="add-card">
        <div class="add-upper">
            <p class="add-tital"><i class="fa-solid fa-circle-plus"></i> Add New Book</p>
            <a href="dashbord.html" class="add-backtohome"><i class="fa-solid fa-arrow-left"></i> Back to Home</a>
        </div>
        <div class="add-conteaner">
            <p class="book-title">Book Title</p>
            <input type="text" id="txtTitle" placeholder="e.g. The Great Gatsby" class="booktitle-input">

            <div class="author-div">
                <div class="x">
                    <p class="author">Author</p>
                    <input type="text" id="txtAuthor" placeholder="F. Scott Fitzgerald">
                </div>
            </div>

            <div class="author-div">
                <div class="x">
                    <p class="author">Total Copies</p>
                    <input type="number" id="numCopies" min="1" value="1">
                </div>

                <div class="x">
                    <p class="author">Cover Image URL (Optional)</p>
                    <input type="url" id="txtUrl" placeholder="https://example.com/image.jpg">
                </div>
            </div>

           <button class="AddBook-btn" id="btnAddBook">Add Book to collection</button>
           <button class="canceladd-btn" onclick="window.location.href='dashbord.html'">Cancel</button>

        </div>
       </div>
     </section>

    <script>
        const btnAddBook = document.getElementById('btnAddBook');

        btnAddBook.addEventListener('click', async () => {
            // Get values from inputs
            const title = document.getElementById('txtTitle').value;
            const author = document.getElementById('txtAuthor').value;
            const copies = document.getElementById('numCopies').value;
            const imageUrl = document.getElementById('txtUrl').value;

            // Basic validation
            if (!title || !author || !copies) {
                alert("Please fill in Title, Author, and Total Copies.");
                return;
            }

            // Create payload matching your C# AddBook model
            const bookData = {
                Title: title,
                Author: author,
                CoverImageUrl: imageUrl,
                AvailableCopies: parseInt(copies)
            };

            try {
                const response = await fetch('http://localhost:5042/api/Book/AddBook', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(bookData)
                });

                if (response.ok) {
                    const message = await response.text();
                    alert(message); // "Book added successfully"
                    window.location.href = 'dashbord.html';
                } else {
                    const error = await response.text();
                    alert("Failed to add book: " + error);
                }
            } catch (err) {
                console.error("Connection error:", err);
                alert("Could not connect to the server.");
            }
        });
    </script>
    </body>
</html>